<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>상품 등록 - 사진 구분형</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Oswald:wght@600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <style>
        :root { --primary-orange: #f37321; }
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f8f9fa; }

        /* 네비게이션 바 (기본 스타일 유지) */
        .main-nav { background: white; border-bottom: 1px solid #eee; }
        .nav-auth-link { color: #333; text-decoration: none; font-size: 0.9rem; }
        .btn-orange { background-color: var(--primary-orange); border: none; color: white; }
        .btn-orange:hover { background-color: #d65f10; color: white; }

        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f4f4f4; padding: 40px 0; }
        .upload-card { max-width: 900px; margin: auto; background: #fff; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); padding: 30px; }

        /* 대표 사진 스타일 */
        .main-upload-zone {
            width: 100%;
            height: 300px;
            border: 2px dashed #0d6efd;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            overflow: hidden;
            background-color: #f0f7ff;
            transition: 0.3s;
            position: relative;
        }
        .main-upload-zone:hover { background-color: #e1eeff; }
        .main-upload-zone img { width: 100%; height: 100%; object-fit: cover; }
        .badge-main { position: absolute; top: 10px; left: 10px; background: #0d6efd; color: #fff; padding: 5px 12px; border-radius: 20px; font-size: 12px; z-index: 5; }

        /* 상세 사진 리스트 스타일 */
        .sub-preview-wrapper { display: flex; gap: 12px; overflow-x: auto; padding: 10px 0; }
        .sub-img-box {
            width: 100px; height: 100px; border: 1px solid #ddd; border-radius: 8px;
            position: relative; flex-shrink: 0; background-size: cover; background-position: center;
        }
        .add-sub-btn {
            width: 100px; height: 100px; border: 1px dashed #ccc; border-radius: 8px;
            display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 24px; color: #aaa;
        }

        .remove-btn {
            position: absolute; top: -5px; right: -5px; background: #ff4d4d; color: white;
            width: 20px; height: 20px; border-radius: 50%; font-size: 12px; line-height: 18px; text-align: center; cursor: pointer; border: none;
        }

        .section-title { font-size: 18px; font-weight: 700; margin-bottom: 15px; color: #333; }
        .form-label { font-weight: 600; color: #555; }
        .btn-submit { background: #333; color: white; padding: 15px; border-radius: 8px; font-weight: bold; width: 100%; margin-top: 30px; border: none; }
        .btn-submit:hover { background: #000; }
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg fixed-top main-nav">
    <div class="container">
        <a class="navbar-brand fw-bold" href="#">
            <img src="https://cdn-icons-png.flaticon.com/512/889/889455.png" alt="logo" width="30" class="me-2"> Basketball Hub
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav mx-auto fw-medium">
                <li class="nav-item"><a class="nav-link active" href="#home">홈</a></li>
                <li class="nav-item"><a class="nav-link" href="#clubs">동호회모집</a></li>
                <li class="nav-item"><a class="nav-link" href="#shop">농구용품샵</a></li>
                <li class="nav-item"><a class="nav-link" href="#matches">친선경기신청</a></li>
                <li class="nav-item"><a class="nav-link" href="#rankings">경기결과/랭킹</a></li>
                <li class="nav-item"><a class="nav-link" href="#board">자유게시판</a></li>
            </ul>
            <div class="d-flex align-items-center gap-3">
                <th:block th:if="${session.user == null}">
                    <a href="/user/login" class="nav-auth-link">로그인</a>
                    <a href="/user/join" class="btn btn-orange text-white px-4 fw-bold shadow-sm">회원가입</a>
                </th:block>
                <th:block th:unless="${session.user== null}">
                    <div class="dropdown">
                        <button class="btn" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-person-fill  nav-auth-link fs-4"></i>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/user/logout">로그아웃</a></li>
                            <li><a class="dropdown-item" href="/user/detail">회원정보</a></li>
                            <th:block th:if="${session.user.userStatus.name() == 'CLUB_PERSISTENT'}"><li><a class="dropdown-item" th:href="|/club/info/${session.user.id}|">동호회 관리</a></li></th:block>
                        </ul>
                    </div>
                </th:block>
            </div>
        </div>
    </div>
</nav>

    <div class="container mt-3">
        <div class="upload-card">
            <form id="productForm">
                <div class="mb-5">
                    <p class="section-title">대표 사진 (1장 필수)</p>
                    <div class="main-upload-zone" id="mainZone">
                        <span class="badge-main">대표이미지</span>
                        <div id="mainPlaceholder" class="text-center">
                            <p class="mb-0">클릭하여 대표 이미지를 업로드하세요</p>
                            <small class="text-muted">가장 먼저 보여질 메인 사진입니다.</small>
                        </div>
                    </div>
                    <input type="file" id="mainInput" accept="image/*" style="display:none;">
                </div>

                <div class="mb-5">
                    <p class="section-title">상세 사진 (여러 장 등록 가능)</p>
                    <div class="sub-preview-wrapper" id="subArea">
                        <div class="add-sub-btn" id="subBtn">+</div>
                    </div>
                    <input type="file" id="subInput" accept="image/*" multiple style="display:none;">
                </div>

                <hr>

                <div class="row g-3 mt-2">
                    <div class="col-md-8">
                        <label class="form-label">상품명</label>
                        <input type="text" id="title" class="form-control form-control-lg" placeholder="상품 이름을 입력하세요" required>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">가격 (₩)</label>
                        <input type="number" id="price" class="form-control form-control-lg" placeholder="0">
                    </div>
                    <div class="col-12">
                        <label class="form-label">거래 위치</label>
                        <input type="text" id="location" class="form-control" placeholder="지역 혹은 지하철역">
                    </div>
                    <div class="col-12">
                        <label class="form-label">상세 설명</label>
                        <textarea id="goodsExplain" class="form-control" rows="6" placeholder="제품의 상태(흠집, 사용감), 구매 시기, 게임 구동 여부 등을 상세히 입력해 주세요."></textarea>
                    </div>
                </div>

                <button type="submit" class="btn-submit shadow">상품 등록 완료</button>
            </form>
        </div>
    </div>



<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
<script>
    $(document).ready(function() {
        let mainFile = null;
        let subFiles = [];

        // --- 대표 사진 처리 ---
        $('#mainZone').click(function() { $('#mainInput').click(); });

        $('#mainInput').change(function(e) {
            const file = e.target.files[0];
            if(file) {
                mainFile = file;
                let reader = new FileReader();
                reader.onload = function(e) {
                    $('#mainZone').html(`
                    <span class="badge-main">대표이미지</span>
                    <img src="${e.target.result}">
                `);
                };
                reader.readAsDataURL(file);
            }
        });

        // --- 상세 사진 처리 ---
        $('#subBtn').click(function() { $('#subInput').click(); });

        $('#subInput').change(function(e) {
            let files = Array.from(e.target.files);
            files.forEach(file => {
                subFiles.push(file);
                let reader = new FileReader();
                reader.onload = function(e) {
                    let html = `
                    <div class="sub-img-box" style="background-image: url('${e.target.result}')">
                        <div class="remove-btn">×</div>
                    </div>
                `;
                    $('#subArea').append(html);
                };
                reader.readAsDataURL(file);
            });
        });

        // 상세 사진 개별 삭제
        $(document).on('click', '.remove-btn', function() {
            const idx = $('.remove-btn').index(this);
            subFiles.splice(idx, 1);
            $(this).parent().remove();
        });

        // --- 폼 제출 ---
        $('#productForm').on('submit', function(e) {
            e.preventDefault();

            let title = $('#title').val();
            let price = $('#price').val();
            let location = $('#location').val();
            let explain = $('#goodsExplain').val();



            if(!mainFile) {
                alert("대표 사진을 1장 이상 등록해 주세요.");
                return;
            }

            // 실제 전송할 데이터 구성
            let formData = new FormData();
            formData.append("mainImage", mainFile);
            subFiles.forEach(file => {
                formData.append(`detailImage`, file);
            });
            formData.append("title", title);
            formData.append("price", price);
            formData.append("location", location);
            formData.append("goodsInfo", explain);

            console.log(title + "\n" + price + "\n" + location + "\n" + explain + "\n" + mainFile + "\n" + subFiles)

            $.ajax({
                type: "post"
                , url: "/goods"
                , data: formData
                , contentType: false
                , processData: false
                , success: function(response){
                    if(response.result === "success"){
                        window.location.href="/goods";
                    }
                }
                , error: function(xhr){
                    let error = xhr.responseJSON;

                    if(error.status == 404){
                        alert(error.message);
                    }else if(error.status == 400){
                        alert(error.message);
                    }

                }
            });
        });
    });
</script>

</body>
</html>