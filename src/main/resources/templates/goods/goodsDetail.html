<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basketball Hub - 물품 상세</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Oswald:wght@600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

    <style>
        :root { --primary-orange: #f37321; }
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f8f9fa; }

        /* 네비게이션 바 */
        .main-nav { background: white; border-bottom: 1px solid #eee; }
        .nav-auth-link { color: #333; text-decoration: none; font-size: 0.9rem; }
        .btn-orange { background-color: var(--primary-orange); border: none; color: white; }
        .btn-orange:hover { background-color: #d65f10; color: white; }

        /* 이미지 섹션 스타일 수정 */
        .club-detail-container { margin-top: 100px; margin-bottom: 50px; }

        .main-club-img-wrapper {
            width: 100%;
            border-radius: 12px;
            overflow: hidden;
            height: 450px; /* 메인 이미지 높이 조정 */
            background-color: #eee;
        }
        .main-club-img { width: 100%; height: 100%; object-fit: cover; }

        /* 썸네일 리스트: 최대 5개 나열을 위한 그리드 설정 */
        .gallery-thumbs {
            display: grid;
            grid-template-columns: repeat(5, 1fr); /* 정확히 5칸으로 나눔 */
            gap: 10px;
            margin-top: 12px;
        }

        .thumb-container {
            position: relative;
            aspect-ratio: 1 / 1; /* 정사각형 유지 */
            overflow: hidden;
            border-radius: 8px;
        }

        .thumb-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            cursor: pointer;
            border: 2px solid transparent;
            transition: 0.2s;
        }

        .thumb-img:hover { opacity: 0.8; }
        .thumb-img.active { border-color: var(--primary-orange); }

        /* 5개 초과시 숨김 처리 (CSS로 제어하거나 서버에서 5개만 내려보내야 함) */
        .thumb-container:nth-child(n+6) {
            display: none;
        }

        /* 상세 정보 카드 */
        .info-card { background: white; border-radius: 15px; padding: 25px; border: none; height: 100%; }
        .info-item { padding: 15px; background: #f8f9fa; border-radius: 10px; margin-bottom: 12px; }
        .text-pre-wrap { white-space: pre-wrap; line-height: 1.6; color: #444; }

        /*구매상태 style*/
        .bg-green-light { background-color: #E8F5E9; color: #2E7D32; }
        .bg-red-light { background-color: #FFEBEE; color: #C62828; }
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg fixed-top main-nav">
    <div class="container">
        <a class="navbar-brand fw-bold" href="#">
            <img src="https://cdn-icons-png.flaticon.com/512/889/889455.png" alt="logo" width="30" class="me-2"> Basketball Hub
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav mx-auto fw-medium">
                <li class="nav-item"><a class="nav-link active" href="#home">홈</a></li>
                <li class="nav-item"><a class="nav-link" href="#clubs">동호회모집</a></li>
                <li class="nav-item"><a class="nav-link" href="#shop">농구용품샵</a></li>
                <li class="nav-item"><a class="nav-link" href="#matches">친선경기신청</a></li>
                <li class="nav-item"><a class="nav-link" href="#rankings">경기결과/랭킹</a></li>
                <li class="nav-item"><a class="nav-link" href="#board">자유게시판</a></li>
            </ul>
            <div class="d-flex align-items-center gap-3">
                <th:block th:if="${session.user == null}">
                    <a href="/user/login" class="nav-auth-link">로그인</a>
                    <a href="/user/join" class="btn btn-orange text-white px-4 fw-bold shadow-sm">회원가입</a>
                </th:block>
                <th:block th:unless="${session.user== null}">
                    <div class="dropdown">
                        <button class="btn" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-person-fill  nav-auth-link fs-4"></i>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/user/logout">로그아웃</a></li>
                            <li><a class="dropdown-item" href="/user/detail">회원정보</a></li>
                            <th:block th:if="${session.user.userStatus.name() == 'CLUB_PERSISTENT'}"><li><a class="dropdown-item" th:href="|/club/info/${session.user.id}|">동호회 관리</a></li></th:block>
                        </ul>
                    </div>
                </th:block>
            </div>
        </div>
    </div>
</nav>

<main class="container club-detail-container">
    <div class="row g-4">
        <div class="col-lg-7">
            <div class="main-club-img-wrapper shadow-sm">
                <img th:src="${detailGoods.mainImage}" id="mainImage" src="https://images.unsplash.com/photo-1546519638-68e109498ffc?w=1000" class="main-club-img" alt="대표 이미지">
            </div>

            <div class="gallery-thumbs">
                <div th:each="detailImage :${detailGoods.getDetailImage()}" class="thumb-container">
                    <img th:src="${detailImage.goodImage}" src="https://images.unsplash.com/photo-1546519638-68e109498ffc" class="thumb-img active">
                </div>
<!--                <div class="thumb-container">-->
<!--                    <img src="https://images.unsplash.com/photo-1519861531473-9200362f46b3" class="thumb-img">-->
<!--                </div>-->
<!--                <div class="thumb-container">-->
<!--                    <img src="https://images.unsplash.com/photo-1504450758481-7338eba7524a" class="thumb-img">-->
<!--                </div>-->
<!--                <div class="thumb-container">-->
<!--                    <img src="https://images.unsplash.com/photo-1511886929837-354d827aae26" class="thumb-img">-->
<!--                </div>-->
<!--                <div class="thumb-container">-->
<!--                    <img src="https://images.unsplash.com/photo-1519861531473-9200362f46b3" class="thumb-img">-->
<!--                </div>-->
            </div>
        </div>

        <div class="col-lg-5">
            <div class="info-card shadow-sm d-flex flex-column">
                <div>
                    <span th:if="${detailGoods.salesStatus.name() == 'SALE'}"  class="badge rounded-pill bg-green-light px-3 py-2">구매가능</span>
                    <span th:if="${detailGoods.salesStatus.name() == 'SOLD_OUT'}"  class="badge rounded-pill bg-red-light px-3 py-2">판매완료</span>
                </div>
                <div class="d-flex align-items-center mb-4 mt-3">
                    <div>
                        <h3 class="fw-bold mb-0">중고 농구화 풀세트</h3>
                        <span th:text="${detailGoods.location}" class="text-muted small"><i class="bi bi-geo-alt-fill"></i> 서울특별시 강남구</span>
                    </div>
                </div>

                <div class="info-item flex-grow-1">
                    <div class="fw-bold mb-2">상세 설명</div>
                    <div th:text="${detailGoods.goodsInfo}" class="text-pre-wrap">사진처럼 외관 이쁘고 상태 괜찮습니다. 실사용 거의 없어서 판매합니다. 윈도우11 설치 완료... (중략) 1세트당 35만원입니다.</div>
                </div>

                <div class="mt-auto">
                    <div class="d-flex justify-content-between align-items-center mb-3 px-2">
                        <span class="text-muted">판매가</span>
                        <h4 th:text="|${#numbers.formatInteger(detailGoods.price, 3 , 'COMMA')}|" class="fw-bold text-orange mb-0">350,000원</h4>
                    </div>
                    <button th:value="${detailGoods.userId}" id="applyBtn" class="btn btn-orange w-100 py-3 fw-bold shadow">
                        <i class="bi bi-chat-dots-fill me-2"></i> 구매 채팅 보내기
                    </button>
                    <button th:if="${session.user.id} == ${detailGoods.userId}" th:Value="${detailGoods.goodsId}" id="soldOutId" class="btn btn-orange py-3 fw-bold shadow mt-3">
                        <i class="bi bi-bag-fill"></i> 구매완료버튼
                    </button>
                </div>
            </div>
        </div>
    </div>
</main>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script th:inline="javascript" >
    $(document).ready(function() {
        // 갤러리 이미지 클릭 시 메인 이미지 변경
        $('.thumb-img').on('click', function() {
            const newSrc = $(this).attr('src');
            $('#mainImage').fadeOut(100, function() {
                $(this).attr('src', newSrc).fadeIn(100);
            });

            $('.thumb-img').removeClass('active');
            $(this).addClass('active');
        });

        $('#applyBtn').on('click', function() {
            // input/button의 value에 담긴 판매자 ID와 상품 ID를 가져옵니다.
            const sellerId = $(this).val();
            const goodsId = [[${detailGoods.goodsId}]];// Thymeleaf 변수

            $.post('/chat/room/goods', { goodsId: goodsId, sellerId: sellerId }, function(roomId) {

                location.href = '/chat';
            }).fail(function(jqXHR, textStatus) {
                // 실패 시 처리 (네트워크 에러, 404, 500 등)
                console.log(jqXHR);
                console.log(jqXHR.responseJSON.message);
                // console.error("통신 실패: " + textStatus, errorThrown);
                alert(jqXHR.responseJSON.message);
            });
        });
    });
</script>
</body>
</html>